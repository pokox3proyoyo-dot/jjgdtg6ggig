<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Secure Hax Chat üîê</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<script src="nacl.min.js"></script>
<script src="nacl-util.min.js"></script>

<style>
/* ==================================== */
/* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –∏ –æ–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã */
/* ==================================== */
:root {
  --bg-color: linear-gradient(135deg, #2c003e, #5a006a, #ff5aab);
  --glass-bg: rgba(255, 255, 255, 0.1);
  --text-color: #f5f5f5;
  --header-color: #ffd6f7;
  --accent-color: #ff5aab;
  --button-gradient: linear-gradient(90deg, #ff5aab, #8a2be2);
  --success-color: #4CAF50;
  --self-msg-bg: #8a2be2; /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π */
  --peer-msg-bg: #4CAF50; /* –ó–µ–ª–µ–Ω—ã–π */
}

body {
  font-family: 'Inter', sans-serif;
  background: var(--bg-color);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  color: var(--text-color);
  margin:0; padding:0;
  transition: background 0.3s ease;
  position: relative;
}

h1 { margin-top: 24px; font-size: 2rem; color: var(--header-color); text-shadow: 0 2px 8px rgba(0,0,0,0.5);}
.container { width: 90%; max-width: 800px; margin: 16px auto; padding-bottom: 50px; z-index: 100;}
.card { background: var(--glass-bg); border-radius: 16px; padding: 20px; margin-bottom: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.4); backdrop-filter: blur(4px); transition: transform 0.2s, box-shadow 0.2s;}
.card:hover { transform: translateY(-2px); box-shadow: 0 12px 24px rgba(0,0,0,0.6);}
textarea, input { width: 100%; box-sizing: border-box; margin: 6px 0; padding: 10px; border-radius: 10px; border: none; background: rgba(255,255,255,0.2); color: #fff; font-family: 'Roboto Mono', monospace; font-size: 0.95rem;}
button { background: var(--button-gradient); color: #fff; border: none; border-radius: 12px; padding: 12px 18px; margin-top: 8px; cursor: pointer; font-weight: 600; transition: transform 0.2s, box-shadow 0.3s, filter 0.2s; white-space: nowrap;}
button:hover { background: linear-gradient(90deg, #ff75c4, #a64ddb); transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.5); filter: brightness(1.1);}
button:active { transform: translateY(0); box-shadow: 0 4px 12px rgba(0,0,0,0.4);}
button:disabled { background: #555; cursor: not-allowed; opacity: 0.7;}
pre { background: var(--glass-bg); padding: 10px; border-radius: 10px; overflow-x: auto; font-size: 0.85rem; color: #fff; font-family: 'Roboto Mono', monospace;}
.row { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
.flex-col { display:flex; flex-direction:column;}
/* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ—É—Ç–µ—Ä –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è Sans */
footer {
  width:100%;
  text-align:center;
  margin:24px 0;
  padding-bottom: 20px;
  position: relative;
  z-index: 100;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.footer-links {
    display: flex;
    justify-content: center;
    align-items: flex-end; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ –Ω–∏–∑—É */
    gap: 15px;
    position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è Sans */
    width: auto;
}
a { color: var(--accent-color); text-decoration: none; transition: color 0.2s;}
a:hover { color: #fff;}

/* ==================================== */
/* –°–ê–ù–° / –ò–ù–¢–ï–†–ê–ö–¢–ò–í */
/* ==================================== */
#sans-image {
  /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ, –Ω–µ–∑–∞–º–µ—Ç–Ω–æ–µ –º–µ—Å—Ç–æ: –≤ —Ñ—É—Ç–µ—Ä–µ, —Ä—è–¥–æ–º —Å –¢–µ–ª–µ–≥—Ä–∞–º–æ–º */
  width: 40px;
  height: 40px;
  cursor: pointer;
  border-radius: 50%;
  transition: transform 0.2s ease-out;
  box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); /* –î–æ–±–∞–≤–∏–º –ª–µ–≥–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ */
  background-color: rgba(255, 255, 255, 0.1); /* –õ–µ–≥–∫–∏–π —Ñ–æ–Ω */
  margin-bottom: -15px; /* –ü–æ–¥–Ω–∏–º–µ–º –µ–≥–æ –∫ Telegram –∏–∫–æ–Ω–∫–µ */
}

#sans-image:hover {
  transform: scale(1.1) rotate(5deg);
  filter: none; /* –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ - —è—Ä–∫–∏–π Sans! */
}

#socks-message {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  padding: 20px 40px;
  background: rgba(0, 0, 0, 0.9);
  color: #fff000; /* –ñ–µ–ª—Ç—ã–π —Ü–≤–µ—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–∞ */
  font-size: 2.5rem;
  font-family: 'Roboto Mono', monospace;
  border: 5px solid #ff5aab;
  box-shadow: 0 0 30px #ff5aab;
  border-radius: 10px;
  z-index: 3000;
  opacity: 0;
  transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  pointer-events: none;
  text-align: center;
}
#socks-message.active {
  transform: translate(-50%, -50%) scale(1);
  opacity: 1;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ (–ò–∑–º–µ–Ω–µ–Ω—ã –¥–ª—è –≤—ã–ª–µ—Ç–∞ —Å –±–æ–∫–æ–≤) */
#confetti-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 2500;
  overflow: hidden;
}
.confetti {
  position: absolute;
  width: 10px;
  height: 10px;
  opacity: 0;
  animation-duration: 3s;
  animation-fill-mode: forwards;
  animation-timing-function: cubic-bezier(.17,.67,.83,.67);
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –≤—ã–ª–µ—Ç–∞ —Å –±–æ–∫–æ–≤ */
@keyframes fall-left {
  0% { left: 0; top: 50%; transform: translate(-100%, -50%) rotate(0deg); opacity: 1; }
  100% { left: 50%; top: 100vh; transform: translate(-50%, 0) rotate(720deg); opacity: 0; }
}
@keyframes fall-right {
  0% { right: 0; top: 50%; transform: translate(100%, -50%) rotate(0deg); opacity: 1; }
  100% { right: 50%; top: 100vh; transform: translate(50%, 0) rotate(-720deg); opacity: 0; }
}

/* ==================================== */
/* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
/* ==================================== */

#menu-btn {
  position: fixed;
  top: 15px;
  left: 15px;
  z-index: 2000;
  width: auto;
  min-width: 90px;
  height: 50px;
  font-size: 1.1rem;
  padding: 0 15px;
  border-radius: 25px;
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  color: var(--header-color);
  display: flex;
  align-items: center;
  justify-content: center;
}
#nav-menu {
  position: fixed;
  top: 70px;
  left: 15px;
  z-index: 1999;
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 15px;
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  transform: translateX(-150%);
  opacity: 0;
  transition: transform 0.3s ease-out, opacity 0.3s ease-out;
}
#nav-menu.active {
  transform: translateX(0);
  opacity: 1;
}
#nav-menu button {
  width: 150px;
  padding: 10px 15px;
  background: rgba(255, 255, 255, 0.1);
  box-shadow: none;
  border-radius: 10px;
}
#nav-menu button.active {
  background: var(--button-gradient);
}
#nav-menu button:hover {
  transform: none;
  box-shadow: 0 0 10px var(--accent-color);
}
.page {
  display: none;
  width: 100%;
  animation: fadeIn 0.5s ease-out;
}
.page.active {
  display: block;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
#home-page {
    background:
        radial-gradient(circle 400px at 50% 10%, rgba(255, 90, 171, 0.1), transparent),
        radial-gradient(circle 300px at 80% 90%, rgba(138, 43, 226, 0.1), transparent),
        repeating-linear-gradient(0deg, #2c003e, #2c003e 1px, transparent 1px, transparent 100px),
        repeating-linear-gradient(90deg, #2c003e, #2c003e 1px, transparent 1px, transparent 100px);
    background-color: #330044;
    padding-top: 20px;
    text-align: center;
}
#home-page h2 { color: var(--accent-color); font-size: 1.5rem; border-bottom: 2px solid var(--accent-color); padding-bottom: 5px; display: inline-block;}
#home-page p { line-height: 1.6; text-align: left; margin-bottom: 20px;}
.skeleton-joke {
    background: var(--glass-bg);
    padding: 15px;
    border-left: 5px solid var(--accent-color);
    font-style: italic;
    color: var(--header-color);
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    text-align: left;
}
.skeleton-joke strong { color: lime; }
.img-grid { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-top: 30px;}
.img-hacker {
  width: 150px;
  height: 150px;
  background: #333;
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.6);
  transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Roboto Mono', monospace;
  font-size: 1.2rem;
  overflow: hidden;
  position: relative;
}
.img-hacker i {
    font-size: 3rem;
    color: var(--success-color);
    text-shadow: 0 0 10px var(--success-color);
    z-index: 2;
}
.img-hacker span {
    position: absolute;
    bottom: 5px;
    font-size: 0.9rem;
    color: #fff;
    z-index: 2;
}
.img-hacker:before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0, 0, 0, 0.4);
  z-index: 1;
}
.img-hacker:hover {
  transform: scale(1.05);
  box-shadow: 0 0 30px var(--accent-color);
}
/* *** –ò–ó–ú–ï–ù–ï–ù–ò–ï –°–¢–ò–õ–ï–ô –î–õ–Ø –ú–ï–ú-–†–ï–ñ–ò–ú–ê *** */
/* –£–±—Ä–∞—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –∫—Ä–æ–º–µ —Ñ–æ–Ω–∞ –∏ —Å–∞–º–æ–≥–æ MEME_PAGE_CONTENT */
.meme-mode > .container,
.meme-mode #menu-btn,
.meme-mode #nav-menu,
.meme-mode footer {
    display: none;
}
.meme-mode {
    background: black !important;
    transition: background 0.1s;
}
/* *** –ö–û–ù–ï–¶ –ò–ó–ú–ï–ù–ï–ù–ò–ô –°–¢–ò–õ–ï–ô *** */

#meme-page-content {
    /* –°—Ç–∏–ª—å –¥–ª—è —Ç–µ–∫—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ body */
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    color: green;
    font-size: 2rem;
    font-family: 'Roboto Mono', monospace;
    z-index: 1000;
    text-shadow: 0 0 10px green, 0 0 20px green;
    overflow: hidden;
    pointer-events: none;
    padding: 20px;
}
.meme-bg-text {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    white-space: pre-wrap;
    word-wrap: break-word;
    color: red;
    opacity: 0.1;
    font-size: 10vmin;
    line-height: 1.2;
    pointer-events: none;
    font-family: 'Roboto Mono', monospace;
    z-index: 999;
    user-select: none;
    padding: 10px;
}
#toast-container { position: fixed; top:20px; right:20px; z-index:9999;}
.toast { background: rgba(255,255,255,0.2); color: #fff; padding: 10px 16px; margin-top: 8px; border-radius: 10px; box-shadow:0 4px 12px rgba(0,0,0,0.5); backdrop-filter: blur(3px); font-weight:500; transition: opacity 0.3s ease, transform 0.3s ease; opacity:0; transform: translateY(-20px);}

/* ------------------------------------- */
/* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –†–ê–ë–û–ß–ï–ì–û –ß–ê–¢–ê */
/* ------------------------------------- */
#live-chat-window {
    height: 400px;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 10px;
    padding: 10px;
    overflow-y: auto;
    margin-bottom: 10px;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
    display: flex;
    flex-direction: column;
}
.msg-container {
    display: flex;
    margin-bottom: 8px;
    word-break: break-word;
    word-wrap: break-word;
}
.msg-bubble {
    max-width: 80%;
    padding: 8px 12px;
    border-radius: 18px;
    font-size: 0.9rem;
    position: relative;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}
.msg-peer {
    justify-content: flex-start;
}
.msg-peer .msg-bubble {
    background-color: var(--peer-msg-bg);
    border-bottom-left-radius: 4px;
}
.msg-self {
    justify-content: flex-end;
}
.msg-self .msg-bubble {
    background-color: var(--self-msg-bg);
    border-bottom-right-radius: 4px;
}
.msg-time {
    display: block;
    font-size: 0.7rem;
    color: rgba(255, 255, 255, 0.7);
    margin-top: 3px;
    text-align: right;
    font-family: 'Roboto Mono', monospace;
}
#message-input-area {
    display: flex;
    gap: 8px;
    margin-top: 10px;
}
#message-input-area textarea {
    flex-grow: 1;
    min-height: 40px;
    resize: none;
    margin: 0;
}
#message-input-area button {
    width: 120px;
    min-width: 100px;
    height: 60px;
    margin: 0;
}

</style>
</head>
<body>

<button id="menu-btn" onclick="toggleMenu()">‚â° Menu</button>
<nav id="nav-menu">
  <button data-page="home" class="active">–ì–ª–∞–≤–Ω–∞—è</button>
  <button data-page="chat">–ß–∞—Ç</button>
  <button data-page="meme">–ú–µ–º</button>
</nav>

<div class="container">
  <div id="home-page" class="page active">
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Secure Hax Chat üîê</h1>

    <div id="socks-message">–Ø –Ω–µ —É–±—Ä–∞–ª –Ω–æ—Å–∫–∏!</div>
    <div id="confetti-container"></div>

    <div class="skeleton-joke">
        "–ü–æ—á–µ–º—É –°–∫–µ–ª–µ—Ç –Ω–µ –ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º —á–∞—Ç–æ–º? –ü–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–µ–≥–æ –Ω–µ—Ç –∫–∏—à–æ–∫, —á—Ç–æ–±—ã –¥–µ–ª–∏—Ç—å—Å—è –∏–º–∏! <strong>Secure Hax</strong> ‚Äì —á–∞—Ç, –∫–æ—Ç–æ—Ä–æ–º—É –º–æ–∂–Ω–æ –¥–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–∏ –∫–æ—Å—Ç–∏."
    </div>

    <div class="card">
      <h2>üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –í–∞—à–∏—Ö –î–∞–Ω–Ω—ã—Ö</h2>
      <p>
        –í –º–∏—Ä–µ, –≥–¥–µ —Ü–∏—Ñ—Ä–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥–≤–µ—Ä–≥–∞–µ—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π —É–≥—Ä–æ–∑–µ, –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ —Ä–æ—Å–∫–æ—à—å—é, –∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å—é. –≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç <strong>–≤—ã—Å–æ–∫–æ–Ω–∞–¥–µ–∂–Ω—É—é –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—É—é –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—é (TweetNaCl)</strong> –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ç–æ–≥–æ, —á—Ç–æ –≤–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤–∞–º –∏ –≤–∞—à–µ–º—É —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É.
      </p>

      <h3>–ü–æ—á–µ–º—É —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ?</h3>
      <p>
        –í–∞—à–∏ –∫–ª—é—á–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ **–ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (localStorage)**. –ú—ã –Ω–µ —Ö—Ä–∞–Ω–∏–º –≤–∞—à–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –∞ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –Ω–∏–∫—Ç–æ, –≤–∫–ª—é—á–∞—è –Ω–∞—Å, –Ω–µ –∏–º–µ–µ—Ç –∫ –Ω–∏–º –¥–æ—Å—Ç—É–ø–∞.
      </p>

      <h3>–ö–∞–∫ –Ω–∞—á–∞—Ç—å?</h3>
      <p>
        –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ß–∞—Ç". –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –ø–∞—Ä—É –∫–ª—é—á–µ–π. –û–±–º–µ–Ω—è–π—Ç–µ—Å—å **–ø—É–±–ª–∏—á–Ω—ã–º** –∫–ª—é—á–æ–º —Å –≤–∞—à–∏–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–º, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ–±–º–µ–Ω –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.
      </p>

      <div class="img-grid">
        <div class="img-hacker">
          <i class="fas fa-key"></i>
          <span>–ö–ª—é—á–∏</span>
        </div>
        <div class="img-hacker">
          <i class="fas fa-lock-open"></i>
          <span>–û–±–º–µ–Ω</span>
        </div>
        <div class="img-hacker">
          <i class="fas fa-shield-alt"></i>
          <span>–ó–∞—â–∏—Ç–∞</span>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>üóÇÔ∏è –ù–∞—à–∞ –§–∏–ª–æ—Å–æ—Ñ–∏—è –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h2>
      <p>
        –ú—ã –≤–µ—Ä–∏–º, —á—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ—Å—Ç–æ–π. –ù–∞—à –∫–æ–¥ ‚Äî –æ—Ç–∫—Ä—ã—Ç—ã–π, –∏ –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ TweetNaCl, –∫–æ—Ç–æ—Ä—ã–π –¥–∞–≤–Ω–æ –ø—Ä–∏–∑–Ω–∞–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º). –ú—ã –Ω–µ —É—Å–ª–æ–∂–Ω—è–µ–º –ø—Ä–æ—Ü–µ—Å—Å: —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –∫–ª—é—á–∏, –æ–±–º–µ–Ω—è–ª—Å—è –ø—É–±–ª–∏—á–Ω—ã–º ‚Äî –∏ —Ç—ã —É–∂–µ –≤ –∫—Ä–∏–ø—Ç–æ-–±—É–Ω–∫–µ—Ä–µ. **–ù–∏–∫–∞–∫–∏—Ö –±—ç–∫–¥–æ—Ä–æ–≤, —Ç–æ–ª—å–∫–æ —Å–∫–µ–ª–µ—Ç—ã –∏ –Ω–∞–¥–µ–∂–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞.**
      </p>
    </div>

    <div class="skeleton-joke">
        "–°–µ–∫—Ä–µ—Ç —Ö–æ—Ä–æ—à–µ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è? –ö–æ—Å—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫—Ä–µ–ø–∫–∏–º–∏, –∞ –∞–ª–≥–æ—Ä–∏—Ç–º - –Ω–µ–ø—Ä–æ–±–∏–≤–∞–µ–º—ã–º! <strong>(–≠—Ç–æ –Ω–µ —Å–∞—Ä–∫–∞–∑–º, —ç—Ç–æ TweetNaCl.)</strong>"
    </div>

    <div class="card">
        <h2>‚ú® –ß—Ç–æ –¥–∞–ª—å—à–µ?</h2>
        <p>
            –ú—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ —É–ª—É—á—à–µ–Ω–∏–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –í –±—É–¥—É—â–µ–º –ø–ª–∞–Ω–∏—Ä—É–µ–º –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–º–µ–Ω–∞ —Ñ–∞–π–ª–∞–º–∏ —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ SOCKS. –ù–æ –ø–æ–∫–∞ —á—Ç–æ, –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å —Å–∞–º—ã–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –∏ –Ω–µ–º–Ω–æ–≥–æ —Å—Ç—Ä–∞–Ω–Ω—ã–º —á–∞—Ç–æ–º –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–µ!
        </p>
    </div>

    <div class="skeleton-joke">
        "–•–∞–∫–µ—Ä-—Å–∫–µ–ª–µ—Ç –∑–∞—à–µ–ª –≤ —á–∞—Ç. –ï–º—É –≥–æ–≤–æ—Ä—è—Ç: '–ü—Ä–∏–≤–µ—Ç!'. –ê –æ–Ω –≤ –æ—Ç–≤–µ—Ç: '–ü—Ä–æ—Å—Ç–æ **–∫–æ—Å—Ç–∏**!'"
    </div>

  </div>

<section id="chat-page" class="page">
    <h1>Secure Hax Chat</h1>
    <p>–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ end-to-end —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ. –í–∞—à–∏ –∫–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ.</p>
    
    <div class="card">
        <h2>Live Chat (<span id="chat-status">üîí –ù–µ—Ç –∫–ª—é—á–µ–π</span>)</h2>
        <div id="live-chat-window">
            <div style="text-align:center; color: var(--accent-color); padding: 20px;">
                üîë –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏ –Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ.
            </div>
        </div>
        <div id="message-input-area">
            <textarea id="liveMessageInput" rows="2" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." disabled></textarea>
            <button id="sendLiveBtn" disabled>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>
    
    <div class="card" id="card-my-keys">
        <h2>1Ô∏è‚É£ –¢–≤–æ–π –∫–ª—é—á</h2>
        <div class="row">
            <button id="gen">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—É –∫–ª—é—á–µ–π</button>
            <button id="resetBtn" class="small">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏</button>
        </div>

        <div id="pubArea" style="display: none; flex-direction: column;">
            <label>–¢–≤–æ–π –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (Base64)</label>
            <textarea id="myPub" rows="3" readonly placeholder="–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏"></textarea>
            <div class="row" style="margin-top: 5px;">
                <button id="copyPub" class="small">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á</button>
            </div>
            <div class="helper">
                –û—Ç–ø–µ—á–∞—Ç–æ–∫: <code id="myFp" style="color:#fff; background:transparent; font-family:monospace;">–ù–µ—Ç –∫–ª—é—á–∞</code>
            </div>
        </div>
    </div>

    <div class="card" id="card-peer">
        <h2>2Ô∏è‚É£ –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞</h2>
        <label>–í—Å—Ç–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ (Base64)</label>
        <textarea id="peerPub" rows="3" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á"></textarea>
        <div class="row">
            <button id="importPeer" class="small" disabled>–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        <div class="helper">
            –û—Ç–ø–µ—á–∞—Ç–æ–∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞: <code id="peerFp" style="color:#fff; background:transparent; font-family:monospace;">–ù–µ—Ç –∫–ª—é—á–∞</code>
        </div>
    </div>

    <div class="card" id="card-encrypt">
        <h2>3Ô∏è‚É£ –†—É—á–Ω–æ–µ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</h2>
        <label>–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</label>
        <textarea id="plain" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"></textarea>
        <div class="row">
            <button id="encryptBtn" class="small" disabled>–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
            <button id="copyCipher" class="small" disabled>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —à–∏—Ñ—Ä—Ç–µ–∫—Å—Ç</button>
        </div>
        <label style="margin-top:10px;">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞</label>
        <textarea id="cipherout" rows="4" readonly></textarea>
    </div>

    <div class="card" id="card-decrypt">
        <h2>4Ô∏è‚É£ –†—É—á–Ω–æ–µ –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</h2>
        <label>–í—Å—Ç–∞–≤—å—Ç–µ —à–∏—Ñ—Ä—Ç–µ–∫—Å—Ç</label>
        <textarea id="cipherin" rows="4" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É"></textarea>
        <div class="row">
            <button id="decryptBtn" class="small" disabled>–î–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
        </div>
        <label style="margin-top:10px;">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
        <textarea id="plainout" rows="4" readonly></textarea>
    </div>
</section>

  <div id="meme-page" class="page"></div>
</div>

<div id="toast-container"></div>
<footer>
    <div class="footer-links">
        <img id="sans-image"
             src="https://avatanplus.com/files/resources/mid/57b39ece5502b15695a4560c.png"
             onclick="activateSansMeme(event)">
        <a href="https://t.me/securehaxchat" target="_blank" title="Telegram">
            <i class="fab fa-telegram fa-2x"></i>
        </a>
    </div>
    <small style="margin-top: 10px;">
        ¬© 2025 Secure Hax Inc. | <a href="#">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
    </small>
</footer>

<script>
// =================================================================
// 1. –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï (–° Google Apps Script URL)
// =================================================================
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzS-3kONY5man8BTV4dI_osZlRdlMCdumPL3xtTDDgCJuw1-a0jGhD7Avojv3IrqcoM/exec'; 
const SESSION_ID = 'secure_hax_chat_id_42'; 
const POLLING_RATE = 5000; // –û–ø—Ä–æ—Å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ (–Ω–∞–¥–µ–∂–Ω–æ –¥–ª—è Sheets)
const MAX_LEN = 5000;
const PUB_LEN = 32;
const NONCE_LEN = 24;

let myKeyPair = null; // { publicKey: Uint8Array, secretKey: Uint8Array }
let peerPubUint8 = null;
let pollingInterval = null; 
const receivedMessageIds = new Set(); // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö ID —Å–æ–æ–±—â–µ–Ω–∏–π

// DOM Elements
const chatWindow = document.getElementById('live-chat-window');
const liveMessageInput = document.getElementById('liveMessageInput');
const sendLiveBtn = document.getElementById('sendLiveBtn');
const chatStatusEl = document.getElementById('chat-status');

// –≠–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ HTML
const genBtn = document.getElementById('gen');
const myPubEl = document.getElementById('myPub');
const myFpEl = document.getElementById('myFp');
const copyPubBtn = document.getElementById('copyPub');
const resetBtn = document.getElementById('resetBtn'); 
const pubArea = document.getElementById('pubArea');

const peerPubEl = document.getElementById('peerPub');
const importPeerBtn = document.getElementById('importPeer');
const peerFpEl = document.getElementById('peerFp');

const plainEl = document.getElementById('plain');
const encryptBtn = document.getElementById('encryptBtn');
const cipherOutEl = document.getElementById('cipherout');
const copyCipherBtn = document.getElementById('copyCipher');

const cipherInEl = document.getElementById('cipherin');
const decryptBtn = document.getElementById('decryptBtn');
const plainOutEl = document.getElementById('plainout');

const toastContainer = document.getElementById('toast-container'); // –û–±—ä—è–≤–ª–µ–Ω –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
const SANS_IMAGE = document.getElementById('sans-image');
const SANS_MESSAGE = document.getElementById('socks-message');
const CONFETTI_CONTAINER = document.getElementById('confetti-container');


// =================================================================
// 2. –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è, Base64, UI)
// =================================================================
const util = nacl.util;
const encodeB64 = util.encodeBase64;
const decodeB64 = util.decodeBase64;
const encodeUTF8 = util.encodeUTF8;
const decodeUTF8 = util.decodeUTF8;

async function sha256hex(u8){
¬† ¬† if (typeof crypto === 'undefined' || !crypto.subtle) return 'Crypto API not available';
¬† ¬† const hash = await crypto.subtle.digest('SHA-256', u8);
¬† ¬† return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
¬† }

function showToast(msg, ms=2600){
¬† ¬† const t = document.createElement('div');
¬† ¬† t.className = 'toast';
¬† ¬† t.textContent = msg;
¬† ¬† toastContainer.appendChild(t);
¬† ¬† // animate in
¬† ¬† requestAnimationFrame(()=>{ t.style.opacity='1'; t.style.transform='translateY(0)'; });
¬† ¬† setTimeout(()=>{ t.style.opacity='0'; t.style.transform='translateY(-10px)'; t.addEventListener('transitionend', ()=> t.remove()); }, ms);
¬† }

function copyToClipboard(txt){
¬† ¬† if(!txt) { showToast('–ù–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è'); return; }
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(txt).then(()=> showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞')).catch(()=>{
            try {
                const tempEl = document.createElement('textarea');
                tempEl.value = txt;
                document.body.appendChild(tempEl);
                tempEl.select();
                document.execCommand('copy');
                document.body.removeChild(tempEl);
                showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
            } catch(e) {
                showToast('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
            }
        });
    } else {
        try {
            const tempEl = document.createElement('textarea');
            tempEl.value = txt;
            document.body.appendChild(tempEl);
            tempEl.select();
            document.execCommand('copy');
            document.body.removeChild(tempEl);
            showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
        } catch(e) {
            showToast('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
        }
    }
}

// –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ–∫–Ω–µ —á–∞—Ç–∞
function displayChatMessage(text, type, timestamp = new Date()) {
    const msgContainer = document.createElement('div');
    msgContainer.className = `msg-container ${type}`;

    const msgBubble = document.createElement('div');
    msgBubble.className = 'msg-bubble';
    
    const timeFormatted = timestamp.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    
    msgBubble.innerHTML = `<span>${text}</span><span class="msg-time">${timeFormatted}</span>`;

    msgContainer.appendChild(msgBubble);
    chatWindow.appendChild(msgContainer);
    chatWindow.scrollTop = chatWindow.scrollHeight; // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
}

function updateChatStatus() {
    if (myKeyPair && peerPubUint8) {
        chatStatusEl.textContent = `‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ. ID: ${encodeB64(myKeyPair.publicKey).slice(0, 10)}`;
        sendLiveBtn.disabled = false;
        liveMessageInput.disabled = false;
    } else if (myKeyPair) {
        chatStatusEl.textContent = '‚ö†Ô∏è –ù–µ—Ç –∫–ª—é—á–∞ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞. –ß–∞—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.';
        sendLiveBtn.disabled = true;
        liveMessageInput.disabled = true;
    } else {
        chatStatusEl.textContent = 'üîí –ù–µ—Ç –∫–ª—é—á–µ–π. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ.';
        sendLiveBtn.disabled = true;
        liveMessageInput.disabled = true;
    }
}

// =================================================================
// 3. –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –ß–ê–¢–ê (Polling, Send/Receive)
// =================================================================

function startPollingForMessages() {
    if (pollingInterval) return; // –£–∂–µ –∑–∞–ø—É—â–µ–Ω

    const poll = () => {
        if (!myKeyPair || !peerPubUint8) {
            clearInterval(pollingInterval);
            pollingInterval = null;
            updateChatStatus();
            return;
        }

        // –ó–∞–ø—Ä–æ—Å –Ω–∞ Google Apps Script
        fetch(`${APPS_SCRIPT_URL}?sessionId=${SESSION_ID}`) 
            .then(response => {
                if (!response.ok) {
                    throw new Error('Server returned error: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                updateChatStatus(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å, –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω

                if (data.ok && data.messages.length > 0) {
                    const mySenderId = encodeB64(myKeyPair.publicKey).slice(0, 10);
                    
                    data.messages.forEach(msg => {
                        // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–æ –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–∂–µ –ø–æ–ª—É—á–µ–Ω–æ
                        if (receivedMessageIds.has(msg.id)) {
                            return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —É–∂–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                        }
                        
                        // 2. –û—Ç–º–µ—á–∞–µ–º –µ–≥–æ –∫–∞–∫ –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ
                        receivedMessageIds.add(msg.id); 

                        // 3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                        const timestamp = new Date(msg.timestamp);

                        // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –Ω–∞—Å, –ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –µ–≥–æ (–µ—Å–ª–∏ –Ω–µ –±—ã–ª–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–æ —Ä–∞–Ω–µ–µ)
                        if (msg.sender === mySenderId) {
                            // –ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –µ–≥–æ —Å—Ä–∞–∑—É –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ, –∑–¥–µ—Å—å –ø—Ä–æ—Å—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º
                            // —á—Ç–æ –æ–Ω–æ –ø–æ–ø–∞–¥–µ—Ç –≤ —á–∞—Ç-–æ–∫–Ω–æ, –µ—Å–ª–∏ –º—ã –µ–≥–æ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏.
                            // –î–ª—è Live-—á–∞—Ç–∞ —ç—Ç–æ –Ω—É–∂–Ω–æ, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É
                            // –∏ –Ω—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é.
                            decryptAndDisplayMessage(msg.encryptedMessage, timestamp, 'msg-self', false);
                        } else {
                            // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞, –¥–µ—à–∏—Ñ—Ä—É–µ–º –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º
                            decryptAndDisplayMessage(msg.encryptedMessage, timestamp, 'msg-peer', true);
                        }
                    });
                }
            })
            .catch(error => {
                console.error('Polling Error:', error);
                chatStatusEl.textContent = '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏/–±—ç–∫–µ–Ω–¥–∞. –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 5—Å...';
            });
    };

    // –ó–∞–ø—É—Å–∫–∞–µ–º Polling –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–µ—Ä–≤—ã–π –æ–ø—Ä–æ—Å
    pollingInterval = setInterval(poll, POLLING_RATE); 
    poll(); 
}

function decryptAndDisplayMessage(encryptedText, timestamp, type, showToastNotification) {
    try {
        const encryptedBytes = decodeB64(encryptedText);
        if (!encryptedBytes || encryptedBytes.length < NONCE_LEN) throw new Error("Invalid encrypted data length.");

        // –ò–∑–≤–ª–µ–∫–∞–µ–º nonce –∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ —à–∏—Ñ—Ä—Ç–µ–∫—Å—Ç
        const nonce = encryptedBytes.slice(0, NONCE_LEN);
        const ciphertext = encryptedBytes.slice(NONCE_LEN);

        // –î–µ—à–∏—Ñ—Ä–æ–≤–∫–∞
        const decryptedBytes = nacl.box.open(
            ciphertext, 
            nonce, 
            peerPubUint8, // –ö–ª—é—á –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (–ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞)
            myKeyPair.secretKey // –ù–∞—à –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
        );

        if (!decryptedBytes) throw new Error("Decryption failed. Check keys.");

        const decryptedText = util.encodeUTF8(decryptedBytes);
        
        displayChatMessage(decryptedText, type, timestamp);

        if (showToastNotification) {
            showToast('üîì –ü–æ–ª—É—á–µ–Ω–æ –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ!', 1500);
        }

    } catch (e) {
        console.error("Decryption or processing error:", e);
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
        if (type === 'msg-peer') {
            displayChatMessage(`[–û–®–ò–ë–ö–ê –î–ï–®–ò–§–†–û–í–ö–ò] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏.`, 'msg-peer', timestamp);
            if (showToastNotification) showToast('‚ùå –û—à–∏–±–∫–∞ –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–∏! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏.', 3000);
        }
    }
}


function sendLiveMessage() {
    if (!myKeyPair || !peerPubUint8) {
        showToast('üîí –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–ª—é—á–∏!', 2000);
        return;
    }

    const message = liveMessageInput.value.trim();
    if (!message) return;

    liveMessageInput.value = ''; // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è
    sendLiveBtn.disabled = true; // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –¥–æ –æ—Ç–≤–µ—Ç–∞

    const messageBytes = util.decodeUTF8(message);
    const nonce = nacl.randomBytes(NONCE_LEN);

    // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ù–ê–® –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∏ –ü–£–ë–õ–ò–ß–ù–´–ô –∫–ª—é—á —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
    const encryptedBytes = nacl.box(
        messageBytes, 
        nonce, 
        peerPubUint8, 
        myKeyPair.secretKey
    );

    // –û–±—ä–µ–¥–∏–Ω—è–µ–º nonce –∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    const fullEncryptedBytes = new Uint8Array(nonce.length + encryptedBytes.length);
    fullEncryptedBytes.set(nonce);
    fullEncryptedBytes.set(encryptedBytes, nonce.length);

    const encryptedText = encodeB64(fullEncryptedBytes);
    const mySenderId = encodeB64(myKeyPair.publicKey).slice(0, 10);
    const sendTimestamp = new Date();


    // üöÄ –û–¢–ü–†–ê–í–ö–ê –ù–ê GOOGLE APPS SCRIPT
    fetch(APPS_SCRIPT_URL, {
        method: 'POST',
        mode: 'cors',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            sessionId: SESSION_ID,
            encryptedMessage: encryptedText,
            sender: mySenderId
        })
    })
    .then(response => response.json())
    .then(data => {
        sendLiveBtn.disabled = false;
        if (data.ok) {
            // –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —É—Å–ø–µ—à–Ω–∞, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            displayChatMessage(message, 'msg-self', sendTimestamp);
            showToast('üîë –°–æ–æ–±—â–µ–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!', 1500);
        } else {
            displayChatMessage(`[–û–®–ò–ë–ö–ê –û–¢–ü–†–ê–í–ö–ò] ${data.description || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'msg-self', sendTimestamp);
            showToast('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ!', 3000);
        }
    })
    .catch(error => {
        console.error('Send Error:', error);
        sendLiveBtn.disabled = false;
        displayChatMessage(`[–û–®–ò–ë–ö–ê –°–ï–¢–ò] –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å.`, 'msg-self', sendTimestamp);
        showToast('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.', 3000);
    });
}


// =================================================================
// 4. –°–ï–ö–¶–ò–Ø –ö–†–ò–ü–¢–û–ì–†–ê–§–ò–ò (–ê–î–ê–ü–¢–ò–†–û–í–ê–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê)
// =================================================================

function enableButtonsForKeys(){
    const hasKeyPair = !!myKeyPair;
    const hasPeerKey = !!peerPubUint8;
    const plainNotEmpty = plainEl.value.trim().length > 0;
    const cipherInNotEmpty = cipherInEl.value.trim().length > 0;

    // Live Chat Status
    updateChatStatus();
    
    // –†—É—á–Ω–∞—è –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è
    importPeerBtn.disabled = peerPubEl.value.trim().length === 0;
    encryptBtn.disabled = !(hasKeyPair && hasPeerKey && plainNotEmpty);
    decryptBtn.disabled = !(hasKeyPair && hasPeerKey && cipherInNotEmpty);
    copyCipherBtn.disabled = cipherOutEl.value.trim().length === 0;

    pubArea.style.display = hasKeyPair ? 'flex' : 'none';

    if (!hasKeyPair) {
      myFpEl.textContent = '–ù–µ—Ç –∫–ª—é—á–∞';
      myPubEl.value = '';
    }
    if (!hasPeerKey) {
      peerFpEl.textContent = '–ù–µ—Ç –∫–ª—é—á–∞';
    }
}

function saveMyPairToStorage(){
    if(!myKeyPair) return;
    try{
      localStorage.setItem('sc_my_pair', JSON.stringify({
        pub: encodeB64(myKeyPair.publicKey),
        sec: encodeB64(myKeyPair.secretKey)
      }));
      showToast('–ü–∞—Ä–∞ –∫–ª—é—á–µ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ localStorage');
      enableButtonsForKeys();
    }catch(e){ showToast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + e.message); }
}

function loadMyPairFromStorage(){
    const raw = localStorage.getItem('sc_my_pair');
    if(!raw) return false;
    try{
      const parsed = JSON.parse(raw);
      myKeyPair = {
        publicKey: decodeB64(parsed.pub),
        secretKey: decodeB64(parsed.sec)
      };
      myPubEl.value = parsed.pub;
      pubArea.style.display = 'flex';
      sha256hex(myKeyPair.publicKey).then(fp=> myFpEl.textContent = fp.slice(0,32));
      showToast('–ü–∞—Ä–∞ –∫–ª—é—á–µ–π –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ localStorage');
      return true;
    }catch(e){ console.error(e); return false; }
}

function loadPeerFromStorage() {
    const raw = localStorage.getItem('sc_peer_pub');
    if(!raw) return false;
    try {
        const u8 = decodeB64(raw);
        if(u8.length !== PUB_LEN) throw new Error('–Ω–µ–≤–µ—Ä–Ω–∞—è –¥–ª–∏–Ω–∞ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞');
        peerPubUint8 = u8;
        peerPubEl.value = raw;
        sha256hex(peerPubUint8).then(fp => peerFpEl.textContent = fp.slice(0,32));
        return true;
    } catch(e) { console.error(e); return false; }
}

function savePeerToStorage(pubB64) {
    localStorage.setItem('sc_peer_pub', pubB64);
}

function clearAllStorage(){
    localStorage.removeItem('sc_my_pair');
    localStorage.removeItem('sc_peer_pub');
    myKeyPair = null;
    peerPubUint8 = null;
    myPubEl.value = '';
    peerPubEl.value = '';
    cipherOutEl.value = '';
    cipherInEl.value = '';
    plainEl.value = '';
    plainOutEl.value = '';
    pubArea.style.display = 'none';
    clearInterval(pollingInterval);
    pollingInterval = null;
    showToast('–í—Å–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∫–ª—é—á–∏ –∏ –ø–æ–ª—è –æ—á–∏—â–µ–Ω—ã');
    enableButtonsForKeys();
}

function generateKeyPair(){
    const kp = nacl.box.keyPair();
    myKeyPair = { publicKey: kp.publicKey, secretKey: kp.secretKey };
    const pubB64 = encodeB64(kp.publicKey);

    myPubEl.value = pubB64;
    pubArea.style.display = 'flex';
    sha256hex(kp.publicKey).then(fp => myFpEl.textContent = fp.slice(0,32));

    saveMyPairToStorage();
    copyToClipboard(pubB64);
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º Polling (–µ—Å–ª–∏ –µ—Å—Ç—å –∫–ª—é—á —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞)
    if (peerPubUint8) startPollingForMessages();

    showToast('–ü–∞—Ä–∞ –∫–ª—é—á–µ–π —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞');
    enableButtonsForKeys();
}

function importPeerFromField(){
    const s = peerPubEl.value.trim();
    if(!s){ showToast('–í—Å—Ç–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ –ø–æ–ª–µ'); return; }
    try{
      const u8 = decodeB64(s);
      if(u8.length !== PUB_LEN) throw new Error('–Ω–µ–≤–µ—Ä–Ω–∞—è –¥–ª–∏–Ω–∞ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞');
      peerPubUint8 = u8;
      sha256hex(peerPubUint8).then(fp => peerFpEl.textContent = fp.slice(0,32));
      savePeerToStorage(s);
      showToast('–ö–ª—é—á —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω');
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º Polling
      if (myKeyPair) {
          clearInterval(pollingInterval); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π, –µ—Å–ª–∏ –±—ã–ª
          pollingInterval = null;
          startPollingForMessages();
      }

      enableButtonsForKeys();
    }catch(e){
      showToast('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –∫–ª—é—á–∞: ' + (e.message||''));
    }
}

function encryptMessage() {
    const text = plainEl.value.trim();
    if (!text || !myKeyPair || !peerPubUint8 || text.length > MAX_LEN) {
        showToast('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ'); return;
    }

    const nonce = nacl.randomBytes(NONCE_LEN);
    const msgUint8 = util.decodeUTF8(text);
    const box = nacl.box(msgUint8, nonce, peerPubUint8, myKeyPair.secretKey);

    cipherOutEl.value = util.encodeBase64(nonce) + ':' + util.encodeBase64(box);
    plainEl.value = '';

    showToast('–°–æ–æ–±—â–µ–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ');
    enableButtonsForKeys();
}

function decryptMessage(){
    const s = cipherInEl.value.trim();
    if(!s || !myKeyPair || !peerPubUint8){ showToast('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏ –∏ —à–∏—Ñ—Ä—Ç–µ–∫—Å—Ç'); return; }
    try{
        const cleanStr = s.replace(/\s+/g,'');
        const parts = cleanStr.split(':');
        if(parts.length !== 2) throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–æ–∂–∏–¥–∞–µ—Ç—Å—è nonce:ct)');

        const nonce = decodeB64(parts[0]);
        const ct = decodeB64(parts[1]);

        const msgU8 = nacl.box.open(ct, nonce, peerPubUint8, myKeyPair.secretKey);
        if(!msgU8) throw new Error('–î–µ—à–∏—Ñ—Ä–æ–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å');

        plainOutEl.value = util.encodeUTF8(msgU8);
        cipherInEl.value = '';
        showToast('–°–æ–æ–±—â–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ');
    }catch(e){
        showToast('–û—à–∏–±–∫–∞ –¥–µ—à–∏—Ñ—Ä–æ–≤–∫–∏: ' + (e.message||''));
    }
}


// =================================================================
// 5. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò
// =================================================================

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
document.addEventListener('DOMContentLoaded', () => {
    loadMyPairFromStorage();
    loadPeerFromStorage();
    enableButtonsForKeys();
    startPollingForMessages(); // –ó–∞–ø—É—Å–∫–∞–µ–º Polling –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª—é—á–µ–π
    showPage('home');
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Live Chat
sendLiveBtn.addEventListener('click', sendLiveMessage);
liveMessageInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey && !sendLiveBtn.disabled) {
        e.preventDefault();
        sendLiveMessage();
    }
});
liveMessageInput.addEventListener('input', () => {
    if (liveMessageInput.value.trim().length > 0) {
        if (myKeyPair && peerPubUint8) sendLiveBtn.disabled = false;
    } else {
        sendLiveBtn.disabled = true;
    }
});


// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –†—É—á–Ω–æ–π –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏
genBtn.addEventListener('click', generateKeyPair);
resetBtn.addEventListener('click', ()=> {
    if(confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∫–ª—é—á–∏ –∏ –ø–æ–ª—è?')) clearAllStorage();
});
copyPubBtn.addEventListener('click', ()=> copyToClipboard(myPubEl.value));
importPeerBtn.addEventListener('click', importPeerFromField);

encryptBtn.addEventListener('click', encryptMessage);
copyCipherBtn.addEventListener('click', ()=> copyToClipboard(cipherOutEl.value));
decryptBtn.addEventListener('click', decryptMessage);

// –°–ª—É—à–∞—Ç–µ–ª–∏ –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ —Ä—É—á–Ω–æ–π –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏
peerPubEl.addEventListener('input', enableButtonsForKeys);
plainEl.addEventListener('input', enableButtonsForKeys);
cipherInEl.addEventListener('input', enableButtonsForKeys);

// –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ
peerPubEl.addEventListener('paste', () => { setTimeout(enableButtonsForKeys, 50); });

// UX: –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –¥–ª—è —Ä—É—á–Ω–æ–π –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏
peerPubEl.addEventListener('keydown', e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); importPeerFromField(); }});
plainEl.addEventListener('keydown', e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); encryptMessage(); }});
cipherInEl.addEventListener('keydown', e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); decryptMessage(); }});

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —à–∏—Ñ—Ä—Ç–µ–∫—Å—Ç–∞
const observer = new MutationObserver(enableButtonsForKeys);
observer.observe(cipherOutEl, { characterData:true, attributes:true, subtree:true, childList:true });


// =================================================================
// 6. –ú–ï–ú–´ –ò –ù–ê–í–ò–ì–ê–¶–ò–Ø
// =================================================================
const state = {
  activePage: 'home',
  memeClicks: 0,
  isMemeActive: false,
  isSansActive: false,
};

const pages = document.querySelectorAll('.page');
const navButtons = document.querySelectorAll('#nav-menu button');
const menuBtn = document.getElementById('menu-btn');
const navMenu = document.getElementById('nav-menu');

function toggleMenu() {
  navMenu.classList.toggle('active');
  menuBtn.textContent = navMenu.classList.contains('active') ? '‚úñ Close' : '‚â° Menu';
}

function showPage(pageId) {
  state.activePage = pageId;
  pages.forEach(page => {
    if (page.id !== pageId + '-page') {
        page.classList.remove('active');
    }
  });

  navButtons.forEach(btn => {
    btn.classList.remove('active');
    if (btn.getAttribute('data-page') === pageId) {
      btn.classList.add('active');
    }
  });

  const currentPage = document.getElementById(pageId + '-page');
  if (currentPage) {
    currentPage.classList.add('active');
  }

  if (pageId === 'meme') {
    enterMemeMode();
  } else {
    exitMemeMode();
  }
}

navButtons.forEach(button => {
  button.addEventListener('click', (e) => {
    const pageId = e.target.getAttribute('data-page');
    showPage(pageId);
    toggleMenu();
  });
});

const CONFETTI_COLORS = ['#ff0000', '#ffff00', '#0000ff', '#ff5aab'];

function createConfetti(count) {
    for (let i = 0; i < count; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.backgroundColor = CONFETTI_COLORS[Math.floor(Math.random() * CONFETTI_COLORS.length)];
        confetti.style.left = (Math.random() < 0.5 ? 0 : 100) + 'vw';
        confetti.style.top = Math.random() * 100 + 'vh';
        confetti.style.width = Math.random() * 10 + 5 + 'px';
        confetti.style.height = confetti.style.width;

        confetti.style.animationName = (i % 2 === 0) ? 'fall-left' : 'fall-right';
        confetti.style.animationDelay = Math.random() * 0.5 + 's';
        confetti.style.animationDuration = Math.random() * 2 + 3 + 's';

        CONFETTI_CONTAINER.appendChild(confetti);

        confetti.addEventListener('animationend', () => {
            confetti.remove();
        });
    }
}

// –ê–∫—Ç–∏–≤–∞—Ü–∏—è –º–µ–º–∞
SANS_IMAGE.addEventListener('click', activateSansMeme);
function activateSansMeme(event) {
    if (state.activePage !== 'home') return;

    if (state.isSansActive) {
        showToast('...—Ç—ã —É–∂–µ —Å–¥–µ–ª–∞–ª —Å–≤–æ–π –≤—ã–±–æ—Ä.', 1000);
        return;
    }

    state.isSansActive = true;
    createConfetti(100);
    SANS_MESSAGE.classList.add('active');

    setTimeout(() => {
        SANS_MESSAGE.classList.remove('active');
        showToast('...–∏ —ç—Ç–æ –º–æ—è –ø–æ—Å–ª–µ–¥–Ω—è—è —à—É—Ç–∫–∞.', 2500);
    }, 2000);
}


const MEME_TEXT_CONTENT = "HAX LO L SOCKS HAXXOR MEME HAXOR LOL SHCURE HAX LOL MEME HAXOR SKUL SOCKS HAX LOL SCURE HAX MEME LOL";
let memeInterval;
let memeBgText;
let memePageContent;

function createMemeBg() {
    memeBgText = document.createElement('div');
    memeBgText.className = 'meme-bg-text';
    document.body.appendChild(memeBgText);
}

function updateMemeBg() {
    if (!memeBgText) return;

    let content = "";
    for (let i = 0; i < 200; i++) {
        const text = MEME_TEXT_CONTENT.split(' ')[Math.floor(Math.random() * MEME_TEXT_CONTENT.split(' ').length)];
        content += text + " ".repeat(Math.floor(Math.random() * 5) + 1);
    }
    memeBgText.textContent = content;
}

function enterMemeMode() {
    if (state.isMemeActive) return;
    state.isMemeActive = true;
    document.body.classList.add('meme-mode');
    if (!memeBgText) createMemeBg();
    updateMemeBg();
    memeInterval = setInterval(updateMemeBg, 100);

    memePageContent = document.createElement('div');
    memePageContent.id = 'meme-page-content';
    memePageContent.innerHTML = `
        <h1>LOADING HACKER.EXE...</h1>
        <p>1337 HAX ACTIVATED. SECURITY IS FOR NOOBS.</p>
    `;
    document.body.appendChild(memePageContent);
}

function exitMemeMode() {
    if (!state.isMemeActive) return;
    state.isMemeActive = false;
    document.body.classList.remove('meme-mode');
    clearInterval(memeInterval);

    if (memeBgText) {
        memeBgText.remove();
        memeBgText = null;
    }
    if (memePageContent) {
        memePageContent.remove();
        memePageContent = null;
    }
}
</script>
</body>
</html>
