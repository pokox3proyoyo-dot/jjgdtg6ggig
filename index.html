<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Secure Hax Chat 2.0 üîê‚ú®</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
:root {
  --bg-color: linear-gradient(135deg, #2c003e, #5a006a, #ff5aab);
  --glass-bg: rgba(255, 255, 255, 0.1);
  --text-color: #f5f5f5;
  --header-color: #ffd6f7;
  --accent-color: #ff5aab;
  --button-gradient: linear-gradient(90deg, #ff5aab, #8a2be2);
  --success-color: #4CAF50;
}

* { box-sizing: border-box; }

body {
  font-family: 'Inter', sans-serif;
  background: var(--bg-color);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  color: var(--text-color);
  margin:0; padding:0;
  transition: background 0.3s ease;
  position: relative;
  overflow-x: hidden;
}

#particle-canvas {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  pointer-events: none;
  z-index: 1;
}

h1 { margin-top: 24px; font-size: 2rem; color: var(--header-color); text-shadow: 0 2px 8px rgba(0,0,0,0.5); z-index: 100;}
.container { width: 90%; max-width: 800px; margin: 16px auto; padding-bottom: 50px; z-index: 100; position: relative;}
.card { 
  background: var(--glass-bg); 
  border-radius: 16px; 
  padding: 20px; 
  margin-bottom: 16px; 
  box-shadow: 0 8px 20px rgba(0,0,0,0.4); 
  backdrop-filter: blur(4px); 
  transition: transform 0.2s, box-shadow 0.2s;
  position: relative;
  overflow: hidden;
}
.card::before {
  content: '';
  position: absolute;
  top: -2px; left: -2px; right: -2px; bottom: -2px;
  background: linear-gradient(45deg, transparent, rgba(255,90,171,0.3), transparent);
  border-radius: 16px;
  opacity: 0;
  transition: opacity 0.3s;
  z-index: -1;
}
.card:hover::before { opacity: 1; }
.card:hover { transform: translateY(-2px); box-shadow: 0 12px 24px rgba(0,0,0,0.6);}

textarea, input { 
  width: 100%; 
  margin: 6px 0; 
  padding: 10px; 
  border-radius: 10px; 
  border: none; 
  background: rgba(255,255,255,0.2); 
  color: #fff; 
  font-family: 'Roboto Mono', monospace; 
  font-size: 0.95rem;
  transition: all 0.3s;
}
textarea:focus, input:focus { 
  outline: none; 
  background: rgba(255,255,255,0.25); 
  box-shadow: 0 0 15px rgba(255,90,171,0.5);
}

button { 
  background: var(--button-gradient); 
  color: #fff; 
  border: none; 
  border-radius: 12px; 
  padding: 12px 18px; 
  margin-top: 8px; 
  cursor: pointer; 
  font-weight: 600; 
  transition: all 0.2s; 
  white-space: nowrap;
  position: relative;
  overflow: hidden;
}
button::after {
  content: '';
  position: absolute;
  top: 50%; left: 50%;
  width: 0; height: 0;
  border-radius: 50%;
  background: rgba(255,255,255,0.3);
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}
button:active::after {
  width: 300px;
  height: 300px;
}
button:hover { 
  background: linear-gradient(90deg, #ff75c4, #a64ddb); 
  transform: translateY(-3px); 
  box-shadow: 0 8px 20px rgba(0,0,0,0.5); 
  filter: brightness(1.1);
}
button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.row { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }

#menu-btn {
  position: fixed;
  top: 15px; left: 15px;
  z-index: 2000;
  min-width: 90px; height: 50px;
  font-size: 1.1rem;
  padding: 0 15px;
  border-radius: 25px;
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  color: var(--header-color);
  display: flex;
  align-items: center;
  justify-content: center;
}

#nav-menu {
  position: fixed;
  top: 70px; left: 15px;
  z-index: 1999;
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 15px;
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  transform: translateX(-150%);
  opacity: 0;
  transition: transform 0.3s ease-out, opacity 0.3s;
}
#nav-menu.active {
  transform: translateX(0);
  opacity: 1;
}
#nav-menu button {
  width: 150px;
  padding: 10px 15px;
  background: rgba(255, 255, 255, 0.1);
  box-shadow: none;
  border-radius: 10px;
}
#nav-menu button.active {
  background: var(--button-gradient);
}

.page {
  display: none;
  width: 100%;
  animation: fadeIn 0.5s;
}
.page.active { display: block; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

#sans-container {
  position: relative;
  display: inline-block;
}
#sans-image {
  width: 50px; height: 50px;
  cursor: pointer;
  border-radius: 50%;
  transition: all 0.3s;
  box-shadow: 0 0 10px rgba(255,255,255,0.3);
  animation: float 3s ease-in-out infinite;
}
@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}
#sans-image:hover {
  transform: scale(1.2) rotate(15deg);
  box-shadow: 0 0 20px rgba(255,90,171,0.8);
}
#sans-counter {
  position: absolute;
  top: -5px; right: -5px;
  background: #ff5aab;
  color: white;
  border-radius: 50%;
  width: 20px; height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  font-weight: bold;
  opacity: 0;
  transition: opacity 0.3s;
}
#sans-counter.show { opacity: 1; }

#socks-message {
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%) scale(0);
  padding: 30px 50px;
  background: rgba(0,0,0,0.95);
  color: #fff000;
  font-size: 3rem;
  font-family: 'Roboto Mono', monospace;
  border: 5px solid #ff5aab;
  box-shadow: 0 0 50px #ff5aab;
  border-radius: 20px;
  z-index: 3000;
  opacity: 0;
  transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  text-align: center;
  animation: rainbow 2s linear infinite;
}
#socks-message.active {
  transform: translate(-50%, -50%) scale(1);
  opacity: 1;
}

@keyframes rainbow {
  0% { border-color: #ff0000; }
  16% { border-color: #ff7f00; }
  33% { border-color: #ffff00; }
  50% { border-color: #00ff00; }
  66% { border-color: #0000ff; }
  83% { border-color: #8b00ff; }
  100% { border-color: #ff0000; }
}

#confetti-container {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  pointer-events: none;
  z-index: 2500;
  overflow: hidden;
}
.confetti {
  position: absolute;
  width: 10px; height: 10px;
  opacity: 0;
  animation-duration: 3s;
  animation-fill-mode: forwards;
  animation-timing-function: cubic-bezier(.17,.67,.83,.67);
}
@keyframes fall-left {
  0% { left: 0; top: 50%; transform: translate(-100%, -50%) rotate(0deg); opacity: 1; }
  100% { left: 50%; top: 100vh; transform: translate(-50%, 0) rotate(720deg); opacity: 0; }
}
@keyframes fall-right {
  0% { right: 0; top: 50%; transform: translate(100%, -50%) rotate(0deg); opacity: 1; }
  100% { right: 50%; top: 100vh; transform: translate(50%, 0) rotate(-720deg); opacity: 0; }
}

.socks-mode {
  background: linear-gradient(135deg, #ff69b4, #ff1493, #ff69b4) !important;
  animation: socksGradient 3s ease infinite !important;
  background-size: 200% 200% !important;
}
@keyframes socksGradient {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

#history-panel {
  position: fixed;
  right: -300px;
  top: 80px;
  width: 280px;
  max-height: 400px;
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 15px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  transition: right 0.3s;
  z-index: 1998;
  overflow-y: auto;
}
#history-panel.active {
  right: 15px;
}
#history-toggle {
  position: fixed;
  right: 15px;
  top: 15px;
  z-index: 1999;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
}
.history-item {
  background: rgba(255,255,255,0.1);
  padding: 10px;
  margin: 8px 0;
  border-radius: 8px;
  font-size: 0.85rem;
  border-left: 3px solid var(--accent-color);
  word-break: break-word;
}

#toast-container { position: fixed; top:20px; right:20px; z-index:9999;}
.toast { 
  background: rgba(255,255,255,0.2); 
  color: #fff; 
  padding: 12px 18px; 
  margin-top: 8px; 
  border-radius: 12px; 
  box-shadow:0 4px 12px rgba(0,0,0,0.5); 
  backdrop-filter: blur(5px); 
  font-weight:500; 
  transition: all 0.3s; 
  opacity:0; 
  transform: translateX(100px);
  border-left: 4px solid var(--accent-color);
}
.toast.show {
  opacity: 1;
  transform: translateX(0);
}

footer {
  width:100%;
  text-align:center;
  margin:24px 0;
  padding-bottom: 20px;
  position: relative;
  z-index: 100;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.footer-links {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
}
a { color: var(--accent-color); text-decoration: none; transition: all 0.2s;}
a:hover { color: #fff; transform: scale(1.1);}

#soundboard {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 10px;
  z-index: 1997;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s;
}
#soundboard.active {
  opacity: 1;
  pointer-events: all;
}
.sound-btn {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  padding: 0;
  margin: 0;
}

.rainbow-mode {
  animation: rainbowBg 5s linear infinite;
}
@keyframes rainbowBg {
  0% { filter: hue-rotate(0deg); }
  100% { filter: hue-rotate(360deg); }
}
</style>
</head>
<body>

<canvas id="particle-canvas"></canvas>

<button id="menu-btn">‚â° Menu</button>
<button id="history-toggle">üìú</button>

<nav id="nav-menu">
  <button data-page="home" class="active">üè† –ì–ª–∞–≤–Ω–∞—è</button>
  <button data-page="chat">üí¨ –ß–∞—Ç</button>
  <button data-page="meme">üé≠ –ú–µ–º</button>
</nav>

<div id="history-panel">
  <h3 style="margin-top:0; color: var(--accent-color);">–ò—Å—Ç–æ—Ä–∏—è üìú</h3>
  <div id="history-list"></div>
  <button id="clearHistoryBtn" style="width:100%; margin-top:10px;">–û—á–∏—Å—Ç–∏—Ç—å</button>
</div>

<div class="container">
  <div id="home-page" class="page active">
    <h1>Secure Hax Chat 2.0 üîê‚ú®</h1>

    <div id="socks-message">üß¶ SOCKS MODE ACTIVATED! üß¶</div>
    <div id="confetti-container"></div>

    <div class="card" style="text-align: center;">
      <h2>üéÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, —Ö–∞–∫–µ—Ä!</h2>
      <p style="text-align: left;">
        –≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —á–∞—Ç. –≠—Ç–æ <strong>—Ç–≤–æ—è —Ü–∏—Ñ—Ä–æ–≤–∞—è –∫—Ä–µ–ø–æ—Å—Ç—å</strong> —Å end-to-end —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º, –º–µ–º–∞–º–∏ –∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ä–µ–∂–∏–º–∞–º–∏! 
      </p>
      <p style="text-align: left; color: #ffd6f7;">
        üíÄ <strong>–°–µ–∫—Ä–µ—Ç—ã:</strong> –ö–ª–∏–∫–∞–π –Ω–∞ Sans 3 —Ä–∞–∑–∞... –∏–ª–∏ –≤–≤–µ–¥–∏ –∫–æ–¥–æ–≤–æ–µ —Å–ª–æ–≤–æ –≤ —á–∞—Ç–µ... üëÄ
      </p>
    </div>

    <div class="card">
      <h2>üõ°Ô∏è –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è –±–µ–∑ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–æ–≤</h2>
      <p>
        –¢–≤–æ–∏ –∫–ª—é—á–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ. –ù–∏–∫—Ç–æ, –¥–∞–∂–µ –º—ã, –Ω–µ –∏–º–µ–µ—Ç –∫ –Ω–∏–º –¥–æ—Å—Ç—É–ø–∞. 
        <strong>TweetNaCl</strong> ‚Äî –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –≤—Ä–µ–º–µ–Ω–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –∑–∞—â–∏—Ç—ã —Ç–≤–æ–∏—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤.
      </p>
    </div>
  </div>

  <section id="chat-page" class="page">
    <h1>üí¨ Secure Chat</h1>

    <div class="card">
      <h2>1Ô∏è‚É£ –¢–≤–æ–∏ –∫–ª—é—á–∏</h2>
      <button id="gen">üîë –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏</button>
      <button id="resetBtn">üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>

      <div id="pubArea" style="display: none; margin-top: 15px;">
        <label>üì§ –¢–≤–æ–π –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á</label>
        <textarea id="myPub" rows="3" readonly></textarea>
        <button id="copyPub">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        <small style="display: block; margin-top: 5px; opacity: 0.7;">
          –û—Ç–ø–µ—á–∞—Ç–æ–∫: <code id="myFp">–ù–µ—Ç –∫–ª—é—á–∞</code>
        </small>
      </div>
    </div>

    <div class="card">
      <h2>2Ô∏è‚É£ –ö–ª—é—á —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞</h2>
      <textarea id="peerPub" rows="3" placeholder="–í—Å—Ç–∞–≤—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞..."></textarea>
      <button id="importPeer" disabled>üì• –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
      <small style="display: block; margin-top: 5px; opacity: 0.7;">
        –û—Ç–ø–µ—á–∞—Ç–æ–∫: <code id="peerFp">–ù–µ—Ç –∫–ª—é—á–∞</code>
      </small>
    </div>

    <div class="card">
      <h2>3Ô∏è‚É£ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</h2>
      <textarea id="plain" rows="4" placeholder="–í–≤–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ... (–∏–ª–∏ —Å–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–ª–æ–≤–æ üëÄ)"></textarea>
      <button id="encryptBtn" disabled>üîí –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
      <button id="copyCipher" disabled>üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
      <textarea id="cipherout" rows="4" readonly style="margin-top: 10px;"></textarea>
    </div>

    <div class="card">
      <h2>4Ô∏è‚É£ –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</h2>
      <textarea id="cipherin" rows="4" placeholder="–í—Å—Ç–∞–≤—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
      <button id="decryptBtn" disabled>üîì –î–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
      <textarea id="plainout" rows="4" readonly style="margin-top: 10px;"></textarea>
    </div>
  </section>

  <div id="meme-page" class="page"></div>
</div>

<div id="soundboard">
  <button class="sound-btn" title="Attack!">‚öîÔ∏è</button>
  <button class="sound-btn" title="Ziel!">üéØ</button>
  <button class="sound-btn" title="Megalovania">üíÄ</button>
</div>

<div id="toast-container"></div>

<footer>
  <div class="footer-links">
    <div id="sans-container">
      <img id="sans-image" 
           src="https://avatanplus.com/files/resources/mid/57b39ece5502b15695a4560c.png">
      <div id="sans-counter">0</div>
    </div>
    <a href="https://t.me/bluzn" target="_blank" title="Telegram">
      <i class="fab fa-telegram fa-2x"></i>
    </a>
  </div>
  <small style="margin-top: 10px;">
    ¬© 2025 Secure Hax Inc. | Made with üíú by –ë–ª—é–∑
  </small>
</footer>

<script src="nacl.min.js"></script>
<script src="nacl-util.min.js"></script>
<script>
// –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ nacl –±–∏–±–ª–∏–æ—Ç–µ–∫
window.addEventListener('load', function() {

// ============ STATE ============
const state = {
  activePage: 'home',
  sansClicks: 0,
  socksMode: false,
  rainbowMode: false,
  history: []
};

// ============ PARTICLES ============
const canvas = document.getElementById('particle-canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const particles = [];
for(let i = 0; i < 50; i++) {
  particles.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    vx: (Math.random() - 0.5) * 0.5,
    vy: (Math.random() - 0.5) * 0.5,
    size: Math.random() * 2 + 1
  });
}

function animateParticles() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = 'rgba(255,255,255,0.5)';
  particles.forEach(p => {
    p.x += p.vx;
    p.y += p.vy;
    if(p.x < 0 || p.x > canvas.width) p.vx *= -1;
    if(p.y < 0 || p.y > canvas.height) p.vy *= -1;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
    ctx.fill();
  });
  requestAnimationFrame(animateParticles);
}
animateParticles();

window.addEventListener('resize', () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

// ============ NAVIGATION ============
const pages = document.querySelectorAll('.page');
const navButtons = document.querySelectorAll('#nav-menu button');
const menuBtn = document.getElementById('menu-btn');
const navMenu = document.getElementById('nav-menu');

function toggleMenu() {
  navMenu.classList.toggle('active');
  menuBtn.innerHTML = navMenu.classList.contains('active') ? '‚úñ Close' : '‚â° Menu';
}

menuBtn.addEventListener('click', toggleMenu);

function showPage(pageId) {
  state.activePage = pageId;
  pages.forEach(p => p.classList.remove('active'));
  navButtons.forEach(b => {
    b.classList.remove('active');
    if(b.getAttribute('data-page') === pageId) b.classList.add('active');
  });
  const page = document.getElementById(pageId + '-page');
  if(page) page.classList.add('active');
  
  document.getElementById('soundboard').classList.toggle('active', pageId === 'chat');
}

navButtons.forEach(btn => {
  btn.addEventListener('click', (e) => {
    showPage(e.target.getAttribute('data-page'));
    toggleMenu();
  });
});

// ============ SANS EASTER EGG ============
const sansImg = document.getElementById('sans-image');
const sansCounter = document.getElementById('sans-counter');
const socksMsg = document.getElementById('socks-message');
const confettiContainer = document.getElementById('confetti-container');

sansImg.addEventListener('click', () => {
  if(state.activePage !== 'home') return;
  
  state.sansClicks++;
  sansCounter.textContent = state.sansClicks;
  sansCounter.classList.add('show');
  
  if(state.sansClicks === 3) {
    activateSansMegalovania();
  } else {
    createConfetti(20);
  }
});

function activateSansMegalovania() {
  state.rainbowMode = true;
  document.body.classList.add('rainbow-mode');
  socksMsg.innerHTML = 'üíÄ YOU\'RE GONNA HAVE A BAD TIME üíÄ';
  socksMsg.classList.add('active');
  createConfetti(200);
  
  setTimeout(() => {
    socksMsg.classList.remove('active');
    showToast('...but nobody came.', 3000);
  }, 3000);
  
  setTimeout(() => {
    document.body.classList.remove('rainbow-mode');
    state.rainbowMode = false;
    state.sansClicks = 0;
    sansCounter.classList.remove('show');
  }, 10000);
}

function createConfetti(count) {
  const colors = ['#ff0000', '#ffff00', '#0000ff', '#ff5aab', '#00ff00'];
  for(let i = 0; i < count; i++) {
    const conf = document.createElement('div');
    conf.className = 'confetti';
    conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    conf.style.width = conf.style.height = Math.random() * 10 + 5 + 'px';
    conf.style.animationName = i % 2 === 0 ? 'fall-left' : 'fall-right';
    conf.style.animationDelay = Math.random() * 0.5 + 's';
    confettiContainer.appendChild(conf);
    conf.addEventListener('animationend', () => conf.remove());
  }
}

// ============ SOCKS MODE ============
function activateSocksMode() {
  if(state.socksMode) return;
  state.socksMode = true;
  document.body.classList.add('socks-mode');
  socksMsg.innerHTML = 'üß¶ SOCKS MODE ACTIVATED! üß¶<br><small style="font-size:1.5rem;">now you\'re one of us... uwu</small>';
  socksMsg.classList.add('active');
  createConfetti(150);
  
  setTimeout(() => {
    socksMsg.classList.remove('active');
  }, 3000);
  
  showToast('Socks mode –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å üß¶‚ú®', 3000);
}

// ============ HISTORY ============
const historyPanel = document.getElementById('history-panel');
const historyList = document.getElementById('history-list');
const historyToggle = document.getElementById('history-toggle');
const clearHistoryBtn = document.getElementById('clearHistoryBtn');

function toggleHistory() {
  historyPanel.classList.toggle('active');
}

historyToggle.addEventListener('click', toggleHistory);

function addToHistory(text, type) {
  state.history.unshift({ text, type, time: new Date().toLocaleTimeString() });
  if(state.history.length > 5) state.history.pop();
  updateHistoryUI();
}

function updateHistoryUI() {
  historyList.innerHTML = state.history.map(h => `
    <div class="history-item">
      <strong>${h.type === 'enc' ? 'üîí' : 'üîì'}</strong> ${h.time}<br>
      <small>${h.text.substring(0, 50)}${h.text.length > 50 ? '...' : ''}</small>
    </div>
  `).join('');
}

function handleClearHistory() {
  state.history = [];
  updateHistoryUI();
  showToast('–ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞');
}

clearHistoryBtn.addEventListener('click', handleClearHistory);

// ============ SOUNDS ============
const soundButtons = document.querySelectorAll('.sound-btn');

function playSound(type) {
  const soundTexts = {
    attack: 'ATTACK THE D POINT!',
    ziel: 'Ziel zerst√∂rt!',
    mega: '*megalovania intensifies*'
  };
  showToast(soundTexts[type] || 'üîä', 1500);
  createConfetti(30);
}

soundButtons.forEach((btn, idx) => {
  const types = ['attack', 'ziel', 'mega'];
  btn.addEventListener('click', () => playSound(types[idx]));
});

// ============ TOAST ============
const toastContainer = document.getElementById('toast-container');

function showToast(msg, ms = 2600) {
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.textContent = msg;
  toastContainer.appendChild(toast);
  
  setTimeout(() => toast.classList.add('show'), 10);
  
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => toast.remove(), 300);
  }, ms);
}

// ============ CRYPTO ============
// –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ nacl –∑–∞–≥—Ä—É–∂–µ–Ω
if(typeof nacl === 'undefined' || typeof nacl.util === 'undefined') {
  showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏!', 5000);
  console.error('nacl –∏–ª–∏ nacl.util –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
  return;
}

const util = nacl.util;
const encodeB64 = util.encodeBase64;
const decodeB64 = util.decodeBase64;
const encodeUTF8 = util.encodeUTF8;
const decodeUTF8 = util.decodeUTF8;

const genBtn = document.getElementById('gen');
const myPubEl = document.getElementById('myPub');
const myFpEl = document.getElementById('myFp');
const copyPubBtn = document.getElementById('copyPub');
const resetBtn = document.getElementById('resetBtn');
const pubArea = document.getElementById('pubArea');

const peerPubEl = document.getElementById('peerPub');
const importPeerBtn = document.getElementById('importPeer');
const peerFpEl = document.getElementById('peerFp');

const plainEl = document.getElementById('plain');
const encryptBtn = document.getElementById('encryptBtn');
const cipherOutEl = document.getElementById('cipherout');
const copyCipherBtn = document.getElementById('copyCipher');

const cipherInEl = document.getElementById('cipherin');
const decryptBtn = document.getElementById('decryptBtn');
const plainOutEl = document.getElementById('plainout');

let myKeyPair = null;
let peerPubUint8 = null;

const MAX_LEN = 5000;
const PUB_LEN = 32;
const NONCE_LEN = 24;

async function sha256hex(u8) {
  if(!crypto.subtle) return 'N/A';
  try {
    const hash = await crypto.subtle.digest('SHA-256', u8);
    return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
  } catch(e) {
    console.error('SHA256 error:', e);
    return 'Error';
  }
}

function copyToClipboard(txt) {
  if(!txt) { showToast('–ù–µ—á–µ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å'); return; }
  if(navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(txt).then(() => {
      showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! üìã');
      createConfetti(15);
    }).catch(() => showToast('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è'));
  } else {
    // Fallback
    const temp = document.createElement('textarea');
    temp.value = txt;
    document.body.appendChild(temp);
    temp.select();
    document.execCommand('copy');
    document.body.removeChild(temp);
    showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! üìã');
    createConfetti(15);
  }
}

function enableButtons() {
  const hasKeys = !!myKeyPair;
  const hasPeer = !!peerPubUint8;
  const hasPlain = plainEl.value.trim().length > 0;
  
  importPeerBtn.disabled = !peerPubEl.value.trim();
  encryptBtn.disabled = !(hasKeys && hasPeer && hasPlain);
  decryptBtn.disabled = !(hasKeys && hasPeer);
  copyCipherBtn.disabled = !cipherOutEl.value.trim();
  
  pubArea.style.display = hasKeys ? 'block' : 'none';
  
  if(!hasKeys) {
    myFpEl.textContent = '–ù–µ—Ç –∫–ª—é—á–∞';
  }
  if(!hasPeer) {
    peerFpEl.textContent = '–ù–µ—Ç –∫–ª—é—á–∞';
  }
}

function saveKeys() {
  if(!myKeyPair) return;
  try {
    localStorage.setItem('hax_keys', JSON.stringify({
      pub: encodeB64(myKeyPair.publicKey),
      sec: encodeB64(myKeyPair.secretKey)
    }));
    console.log('Keys saved to localStorage');
  } catch(e) { 
    console.error('Save error:', e); 
    showToast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–ª—é—á–µ–π');
  }
}

function loadKeys() {
  const raw = localStorage.getItem('hax_keys');
  if(!raw) return false;
  try {
    const data = JSON.parse(raw);
    myKeyPair = {
      publicKey: decodeB64(data.pub),
      secretKey: decodeB64(data.sec)
    };
    myPubEl.value = data.pub;
    sha256hex(myKeyPair.publicKey).then(fp => myFpEl.textContent = fp.slice(0,32));
    showToast('–ö–ª—é—á–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞');
    enableButtons();
    return true;
  } catch(e) { 
    console.error('Load error:', e);
    return false; 
  }
}

function generateKeyPair() {
  try {
    const kp = nacl.box.keyPair();
    myKeyPair = { publicKey: kp.publicKey, secretKey: kp.secretKey };
    const pubB64 = encodeB64(kp.publicKey);
    
    myPubEl.value = pubB64;
    sha256hex(kp.publicKey).then(fp => myFpEl.textContent = fp.slice(0,32));
    
    saveKeys();
    copyToClipboard(pubB64);
    showToast('–ö–ª—é—á–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã! üîë');
    createConfetti(50);
    enableButtons();
  } catch(e) {
    console.error('Generate error:', e);
    showToast('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π: ' + e.message);
  }
}

function importPeer() {
  const txt = peerPubEl.value.trim();
  if(!txt) { showToast('–í—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞'); return; }
  try {
    const u8 = decodeB64(txt);
    if(u8.length !== PUB_LEN) throw new Error('–ù–µ–≤–µ—Ä–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–ª—é—á–∞ (–æ–∂–∏–¥–∞–µ—Ç—Å—è 32 –±–∞–π—Ç–∞)');
    peerPubUint8 = u8;
    sha256hex(u8).then(fp => peerFpEl.textContent = fp.slice(0,32));
    showToast('–ö–ª—é—á –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω! üîì');
    enableButtons();
  } catch(e) {
    console.error('Import error:', e);
    showToast('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ' + e.message);
  }
}

function encryptMessage() {
  const text = plainEl.value.trim();
  if(!text) { showToast('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'); return; }
  if(!myKeyPair || !peerPubUint8) { showToast('–ù–µ—Ç –∫–ª—é—á–µ–π'); return; }
  
  try {
    // Check for secret code
    if(text.toLowerCase().includes('socks') || text.toLowerCase().includes('–Ω–æ—Å–∫–∏')) {
      activateSocksMode();
    }
    
    const nonce = nacl.randomBytes(NONCE_LEN);
    const msgU8 = encodeUTF8(text);
    const box = nacl.box(msgU8, nonce, peerPubUint8, myKeyPair.secretKey);
    const result = encodeB64(nonce) + ':' + encodeB64(box);
    
    cipherOutEl.value = result;
    plainEl.value = '';
    
    addToHistory(text, 'enc');
    showToast('–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ! üîí');
    createConfetti(25);
    enableButtons();
  } catch(e) {
    console.error('Encrypt error:', e);
    showToast('–û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è: ' + e.message);
  }
}

function decryptMessage() {
  const txt = cipherInEl.value.trim();
  if(!txt) { showToast('–í—Å—Ç–∞–≤—å—Ç–µ —à–∏—Ñ—Ä—Ç–µ–∫—Å—Ç'); return; }
  if(!myKeyPair || !peerPubUint8) { showToast('–ù–µ—Ç –∫–ª—é—á–µ–π'); return; }
  
  try {
    const clean = txt.replace(/\s+/g, '');
    const parts = clean.split(':');
    if(parts.length !== 2) throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–æ–∂–∏–¥–∞–µ—Ç—Å—è nonce:ciphertext)');
    
    const nonce = decodeB64(parts[0]);
    const ct = decodeB64(parts[1]);
    
    if(nonce.length !== NONCE_LEN) throw new Error('–ù–µ–≤–µ—Ä–Ω–∞—è –¥–ª–∏–Ω–∞ nonce');
    
    const msgU8 = nacl.box.open(ct, nonce, peerPubUint8, myKeyPair.secretKey);
    if(!msgU8) throw new Error('–î–µ—à–∏—Ñ—Ä–æ–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å (–Ω–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)');
    
    const text = decodeUTF8(msgU8);
    plainOutEl.value = text;
    cipherInEl.value = '';
    
    addToHistory(text, 'dec');
    showToast('–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ! üîì');
    createConfetti(25);
  } catch(e) {
    console.error('Decrypt error:', e);
    showToast('–û—à–∏–±–∫–∞ –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è: ' + e.message);
  }
}

function clearAll() {
  if(!confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏ –∏ –¥–∞–Ω–Ω—ã–µ?')) return;
  localStorage.clear();
  myKeyPair = null;
  peerPubUint8 = null;
  myPubEl.value = '';
  peerPubEl.value = '';
  cipherOutEl.value = '';
  cipherInEl.value = '';
  plainEl.value = '';
  plainOutEl.value = '';
  myFpEl.textContent = '–ù–µ—Ç –∫–ª—é—á–∞';
  peerFpEl.textContent = '–ù–µ—Ç –∫–ª—é—á–∞';
  showToast('–í—Å—ë –æ—á–∏—â–µ–Ω–æ! üóëÔ∏è');
  enableButtons();
}

// Event Listeners
genBtn.addEventListener('click', generateKeyPair);
resetBtn.addEventListener('click', clearAll);
copyPubBtn.addEventListener('click', () => copyToClipboard(myPubEl.value));
importPeerBtn.addEventListener('click', importPeer);
encryptBtn.addEventListener('click', encryptMessage);
copyCipherBtn.addEventListener('click', () => copyToClipboard(cipherOutEl.value));
decryptBtn.addEventListener('click', decryptMessage);

peerPubEl.addEventListener('input', enableButtons);
plainEl.addEventListener('input', enableButtons);
cipherOutEl.addEventListener('input', enableButtons);

plainEl.addEventListener('keydown', e => {
  if(e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    if(!encryptBtn.disabled) encryptMessage();
  }
});

cipherInEl.addEventListener('keydown', e => {
  if(e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    if(!decryptBtn.disabled) decryptMessage();
  }
});

// Init
loadKeys();
enableButtons();
showPage('home');

console.log('Secure Hax Chat initialized!');
console.log('nacl version:', nacl.version || 'unknown');

}); // end window.load
</script>
</body>
</html>